@inject AutoCAC.Services.UserContextService UserContext

@if(UserContext is null)
{
    <h4>Loading...</h4>
}
else if (isAuthorized)
{
    @ChildContent
}
else
{
    @if (Unauthorized != null)
    {
        @Unauthorized
    }
    else
    {
        <h3 class="text-danger">@GetUnauthorizedMessage()</h3>
    }
}

@code {
    [Parameter] public IEnumerable<string> Groups { get; set; }

    [Parameter] public RenderFragment ChildContent { get; set; }

    [Parameter] public RenderFragment Unauthorized { get; set; }

    private bool isAuthorized;

    protected override void OnParametersSet()
    {
        isAuthorized = UserContext.IsInGroupOrSuperuser(Groups?.ToArray());
    }
    private string GetUnauthorizedMessage()
    {
        var message = "You are not authorized to view this content. " +
                      "To view this content, you must be listed as an active user";

        if (Groups?.Any() == true)
        {
            var groupList = string.Join(", ", Groups);
            message += $" AND be a member of one of these groups: {groupList}.";
        }

        return message;
    }

}
