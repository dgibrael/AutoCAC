@page "/settings/searchtemplates"
@using AutoCAC.Models
@inject DialogService DialogService
@inject IDbContextFactory<mainContext> DbFactory
@inject AutoCAC.Services.UserContextService UserContext
@inject NavigationManager NavigationManager
<PageTitle>Search Template Settings</PageTitle>
<RadzenLink Path="/settings" Icon="arrow_back" Text="Back to Settings Home"/>
<DataGridEditable TItem="DataGridTemplate" DefaultAddButton="false"
                  DataGridName="DataGridTemplate">
    <ChildContent>
        <RadzenDataGridColumn TItem="DataGridTemplate" Property="TemplateName" Title="Template Name">
            <EditTemplate Context="r">
                <RadzenTextBox @bind-Value="r.TemplateName" Style="width:100%" />
            </EditTemplate>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="DataGridTemplate" Property="IsShared" Title="Shared">
            <EditTemplate Context="r">
                <RadzenCheckBox @bind-Value="r.IsShared" />
            </EditTemplate>
        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="DataGridTemplate" Property="DataGridName" Title="Table Name" />
    </ChildContent>
</DataGridEditable>

@code {
    private DataGridHelper<DataGridTemplate> _helper;
    protected override void OnInitialized()
    {
        _helper = new DataGridHelper<DataGridTemplate>(
            DbFactory,
            source: db => db.DataGridTemplates
              .AsNoTracking()
              .Where(x => x.CreatedBy == UserContext.Username)
        );
    }
}

